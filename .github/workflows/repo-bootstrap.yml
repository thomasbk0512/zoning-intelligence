name: Repo Bootstrap (One-Time)

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Add only-if-missing files (nothing under .github/workflows/)
      - name: Add baseline files (no overwrite)
        run: |
          [ -f .gitignore ] || cat > .gitignore <<'EOF'
          .DS_Store
          node_modules/
          dist/
          build/
          .venv/
          venv/
          __pycache__/
          .pytest_cache/
          backups/
          data/austin_test*/
          tests/golden_new/
          EOF

          [ -f README.md ] || cat > README.md <<'EOF'
          # zoning-intelligence
          Bootstrap commit created by GitHub Actions.
          EOF

      - name: Create PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: bootstrap repo (add baseline files if missing)"
          title: "chore: bootstrap repo"
          body: "Adds baseline files if missing. Safe to re-run."
          branch: chore/bootstrap-repo
          branch-suffix: short-commit-hash   # avoids 'branch exists' collisions
          delete-branch: true
