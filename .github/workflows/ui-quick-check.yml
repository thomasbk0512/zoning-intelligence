name: UI Quick Check

on:
  pull_request:
    paths:
      - "ui/**"
      - ".github/workflows/ui-quick-check.yml"

jobs:
  ui-check:
    name: UI / Quick Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Detect UI changes
        id: changed
        run: |
          if git diff --name-only origin/${{ github.base_ref }}... | grep '^ui/'; then
            echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=false" >> $GITHUB_OUTPUT
          fi

      - name: Skip if no UI changes
        if: steps.changed.outputs.changed == 'false'
        run: echo "No UI changes; skipping." 

      - name: Setup Node
        if: steps.changed.outputs.changed == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
          cache: "npm"
          cache-dependency-path: "ui/package-lock.json"

      - name: Install deps
        if: steps.changed.outputs.changed == 'true'
        working-directory: ui
        run: npm ci || npm install

      - name: Lint (if present)
        if: steps.changed.outputs.changed == 'true'
        working-directory: ui
        run: npm run lint --if-present

      - name: Build (if present)
        if: steps.changed.outputs.changed == 'true'
        working-directory: ui
        run: npm run build --if-present

      - name: Unit tests (if present)
        if: steps.changed.outputs.changed == 'true'
        working-directory: ui
        run: npm test --if-present

      - name: Always succeed if scripts missing
        if: steps.changed.outputs.changed == 'true'
        run: echo "UI quick check completed."

